<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Discord Clone</title>
    <link rel="stylesheet" href="/css/style.css?v=3">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div class="app-layout" id="app" style="display: none;">
    <nav th:replace="~{fragments/server-nav :: server-nav}"></nav>
    <aside th:replace="~{fragments/channel-sidebar :: channel-sidebar}"></aside>
    <main th:replace="~{fragments/chat-content :: chat-content}"></main>
</div>

<div th:replace="~{fragments/modals :: modals}"></div>

<script src="/js/api.js?v=1"></script>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script src="/js/home.js?v=5"></script>
<script src="/js/user.js?v=2"></script>
<script src="/js/server.js?v=2"></script>
<script src="/js/channel.js?v=2"></script>
<script src="/js/chat.js?v=2"></script>
<script src="/js/upload.js?v=2"></script>

<script>
    function switchToDM() { toggleViews('dm'); }
    function switchToServer(el) {
        document.querySelectorAll('.sidebar-item').forEach(e => e.classList.remove('active'));
        if (el) el.classList.add('active');
        toggleViews('server');
    }
    function toggleViews(type) {
        const isServer = type === 'server';
        const serverChannels = document.getElementById('server-channels-view');
        const dmChannels     = document.getElementById('dm-channels-view');
        const serverChat     = document.getElementById('server-chat-view');
        const dmDashboard    = document.getElementById('dm-dashboard-view');
        const dmConversation = document.getElementById('dm-conversation-view');

        if (serverChannels) serverChannels.style.display = isServer ? 'flex' : 'none';
        if (dmChannels)     dmChannels.style.display     = isServer ? 'none' : 'flex';
        if (serverChat)     serverChat.style.display     = isServer ? 'flex' : 'none';

        // Mặc định DM -> Dashboard
        const isDM = !isServer;
        if (dmDashboard)    dmDashboard.style.display    = isDM ? 'flex' : 'none';
        if (dmConversation) dmConversation.style.display = 'none';
    }

    // Mặc định mở DM như dm-ui
    switchToDM();
</script>
</body>
</html>